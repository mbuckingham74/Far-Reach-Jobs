{% extends "base.html" %}

{% block title %}Far Reach Jobs - Alaska Bush & Rural US Jobs{% endblock %}

{% block content %}
<div class="mb-6 sm:mb-8">
    <h2 class="text-2xl sm:text-3xl font-bold text-gray-900 dark:text-white mb-2">Find Jobs in Remote Alaskan Communities</h2>
    <p class="text-gray-600 dark:text-gray-300">Discover job opportunities in Alaska bush communities and rural US towns.</p>
</div>

<!-- Stats Banner -->
<div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6 sm:mb-8"
     hx-get="/api/jobs/stats"
     hx-trigger="load"
     hx-swap="innerHTML">
    <!-- Placeholder while loading -->
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-4 text-center">
        <div class="text-2xl sm:text-3xl font-bold text-blue-600 dark:text-blue-400">-</div>
        <div class="text-sm text-gray-600 dark:text-gray-400">Sources</div>
    </div>
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-4 text-center">
        <div class="text-2xl sm:text-3xl font-bold text-purple-600 dark:text-purple-400">-</div>
        <div class="text-sm text-gray-600 dark:text-gray-400">Jobs Available</div>
    </div>
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-4 text-center">
        <div class="text-2xl sm:text-3xl font-bold text-green-600 dark:text-green-400">-</div>
        <div class="text-sm text-gray-600 dark:text-gray-400">New This Week</div>
    </div>
</div>

<!-- Search and Filters -->
<div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-4 sm:p-6 mb-6 transition-colors">
    <form id="job-filters"
          hx-get="/api/jobs"
          hx-target="#job-list"
          hx-trigger="submit"
          hx-indicator="#job-list-container">
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
            <div>
                <label for="q" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Search</label>
                <input type="text" id="q" name="q" placeholder="Job title, keywords..."
                       hx-get="/api/jobs"
                       hx-target="#job-list"
                       hx-trigger="keyup changed delay:400ms"
                       hx-include="#job-filters"
                       class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-white dark:bg-gray-700 dark:text-white dark:placeholder-gray-400">
            </div>
            <div>
                <label for="location" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">City or Tribal Community</label>
                <select id="location" name="location"
                        onchange="htmx.ajax('GET', '/api/jobs', {target:'#job-list', source:'#job-filters'})"
                        class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-white dark:bg-gray-700 dark:text-white">
                    <option value="">All Locations</option>
                    {% for loc in locations %}
                    <option value="{{ loc }}">{{ loc }}</option>
                    {% endfor %}
                </select>
            </div>
            <div>
                <label for="job_type" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Job Type</label>
                <select id="job_type" name="job_type"
                        hx-get="/api/jobs"
                        hx-target="#job-list"
                        hx-trigger="change"
                        hx-include="#job-filters"
                        class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-white dark:bg-gray-700 dark:text-white">
                    <option value="">All Types</option>
                    <option value="full-time">Full-time</option>
                    <option value="part-time">Part-time</option>
                    <option value="seasonal">Seasonal</option>
                    <option value="contract">Contract</option>
                    <option value="temporary">Temporary</option>
                </select>
            </div>
        </div>

        <!-- Advanced Filters Toggle -->
        <div class="mt-4 flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4">
            <div class="flex gap-2">
                <button type="submit" class="w-full sm:w-auto px-4 py-2 bg-primary-600 hover:bg-primary-700 text-white font-medium rounded-md transition-colors">
                    Search
                </button>
                <button type="button" onclick="clearFilters()" class="w-full sm:w-auto px-4 py-2 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-200 font-medium rounded-md transition-colors">
                    Clear Filters
                </button>
            </div>
            <button type="button" onclick="toggleAdvancedFilters()" class="flex items-center gap-1 text-sm text-gray-600 dark:text-gray-400 hover:text-primary-600 dark:hover:text-primary-400 transition-colors">
                <svg id="advanced-toggle-icon" class="w-4 h-4 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                </svg>
                <span id="advanced-toggle-text">Advanced Filters</span>
            </button>
        </div>

        <!-- Advanced Filters Panel (collapsed by default) -->
        <div id="advanced-filters" class="hidden mt-4 pt-4 border-t border-gray-200 dark:border-gray-700">
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                <div>
                    <label for="date_posted" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Date Posted</label>
                    <select id="date_posted" name="date_posted"
                            hx-get="/api/jobs"
                            hx-target="#job-list"
                            hx-trigger="change"
                            hx-include="#job-filters"
                            class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-white dark:bg-gray-700 dark:text-white">
                        <option value="">Any time</option>
                        <option value="1">Last 24 hours</option>
                        <option value="7">Last 7 days</option>
                        <option value="30">Last 30 days</option>
                    </select>
                </div>
                <div>
                    <label for="organization" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Organization</label>
                    <select id="organization" name="organization"
                            hx-get="/api/jobs"
                            hx-target="#job-list"
                            hx-trigger="change"
                            hx-include="#job-filters"
                            class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-white dark:bg-gray-700 dark:text-white">
                        <option value="">All Organizations</option>
                        {% for org in organizations %}
                        <option value="{{ org }}">{{ org }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div>
                    <label for="source_id" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Source</label>
                    <select id="source_id" name="source_id"
                            hx-get="/api/jobs"
                            hx-target="#job-list"
                            hx-trigger="change"
                            hx-include="#job-filters"
                            class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-white dark:bg-gray-700 dark:text-white">
                        <option value="">All Sources</option>
                        {% for source in sources %}
                        <option value="{{ source.id }}">{{ source.name }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
        </div>
    </form>
</div>

<!-- Job Listings Container -->
<div id="job-list-container">
    <!-- Loading indicator -->
    <div id="loading-indicator" class="htmx-indicator text-center py-12">
        <div class="inline-block w-8 h-8 border-4 border-gray-200 dark:border-gray-700 border-t-primary-600 rounded-full animate-spin"></div>
        <p class="mt-3 text-gray-500 dark:text-gray-400">Loading jobs...</p>
    </div>

    <!-- Job Listings -->
    <div id="job-list" hx-get="/api/jobs" hx-trigger="load" hx-indicator="closest #job-list-container">
        <!-- Jobs will be loaded here via HTMX -->
    </div>
</div>

<style>
    #job-list-container.htmx-request .htmx-indicator {
        display: block;
    }
    #job-list-container.htmx-request #job-list {
        opacity: 0.5;
        transition: opacity 0.2s ease;
    }
</style>

<script>
function clearFilters() {
    document.getElementById('q').value = '';
    document.getElementById('location').value = '';
    document.getElementById('job_type').value = '';
    document.getElementById('date_posted').value = '';
    document.getElementById('organization').value = '';
    document.getElementById('source_id').value = '';
    htmx.trigger('#job-filters', 'submit');
}

function toggleAdvancedFilters() {
    const panel = document.getElementById('advanced-filters');
    const icon = document.getElementById('advanced-toggle-icon');
    const text = document.getElementById('advanced-toggle-text');

    if (panel.classList.contains('hidden')) {
        panel.classList.remove('hidden');
        icon.style.transform = 'rotate(180deg)';
        text.textContent = 'Hide Advanced Filters';
    } else {
        panel.classList.add('hidden');
        icon.style.transform = 'rotate(0deg)';
        text.textContent = 'Advanced Filters';
    }
}
</script>
{% endblock %}
